<!doctype html>
<html>
    <head>
        <meta charset="utf8">
        <title>Commute Time</title>
        <style>
            /* This is CSS */
            body {
                margin: 0;
                padding: 0;
                color:#000;
                background: #A9A9A9;
                font-size:120%;
            }

            h1 {
                margin-top: 0;
                color:rgb(58, 58, 58);
                background: rgb(2, 212, 166);
                top: 0;
                text-align: center ;
                background-size: 100%;
            }
            h.bigger {
                font-size:150%;
                text-decoration: underline;
            }
            p {
                text-align: center;
            }

            p2 {
                text-align: center;
            }

            .red {
                color: #df0000;
            }
            .green { /* OK, a bit contrived... */
                color: #00ff00;
            }
            .pink { /* OK, a bit contrived... */
                color: #FF1493;
            }
            .blue { /* OK, a bit contrived... */
                color: #0000ff;
            }
            .subtitle {
                font-size:140%;
                text-decoration: underline;
            }


            .column-left {
              float: right;

            }
            .column-right {
              margin-right: 100px;
              float: left;

            }

            .picture {
              margin: auto;
              max-width: 40%;
            }

            .center_text {
              position: absolute;
              left: 50%;
            }

            a:link {
              color: black;
              background-color: transparent;
              text-decoration: underline;
            }

            a:visited {
              color: black;
              background-color: transparent;
              text-decoration: none;
            }

            a:hover {
              color: black;
              background-color: transparent;
              text-decoration: underline;
            }

            a:active {
              color: black;
              background-color: transparent;
              text-decoration: underline;
            }

            .max-width {
              max-width: 80%;
              margin: auto;
            }
            .min-width {
              max-width: 60%;
              margin: auto;
            }

            .graph-width {
              max-width: 75%;
              margin: auto;
            }
          }

        </style>
    </head>
    <body>
        <h1>
            <h class ="bigger">Commute Time Simulation:</h>
            <div>Understand how method of transporation affects commute time</div>
            <img src="commute.jpg" alt="commute">
        </h1>
        <div class="max-width">
        <p class = "min-width"> According to research by the <a href="https://oem.bmj.com/content/77/2/77">
          Finnish Institute for Health and Welfare</a>, longer commute time increases
          the risk of physical inactivity and sleep problems. Therefore, we want to
          explore how different methods of transportation affect total average
          commute time in a city.
        </p>

        <p>
            <span class="subtitle">How our simulation works:</span><br>

            <span class="red"> Red</span> represents the the traffic in an particular intersection <br>
            <span class="pink">Pink</span> represent a workplace.<br>
            <button id="simpleButton" type="button">Simulate!</button>
        </p>
        <p>
            <canvas id="graph_intro" width="500" height="200"></canvas>
        </p>


        <p>
            <span class="subtitle">Let's explore different ratios of transporation methods:</span><br>
            City Population Density: 30000 people per square mile <br>
            95% poeple commute by <span class="red"> car</span> <br>
            3% people commute by <span class="blue"> bus</span> <br>
            2% people commute by foot <br>
            Your commute distance:
            <button id="button" type="button">Simulate!</button> <br>
            <br>
            On average it will take:
            <br>
            a car <span class="red" id="averageCar"> </span> minutes
            <br>
            a bus <span class="red" id="averageBus"> </span> minutes
            <br>
            a pedestrian <span class="red" id="averageWalk"> </span> minutes
            <br>
            to commute from home to work.
            <br>
            Average commuteTime for the city is <span class="red" id="averageCity"> </span> minutes
            <br>
        </p>
        <div class = "graph-width">
        <div class = "column-left">
          <canvas id="bar" width="400" height="400"></canvas>
        </div>
        <div id = "column-right">
          <canvas id="graph" width="400" height="400"></canvas>
        </div>
      </div>

        <p>
            <span class="subtitle">Let's see what happens when more people take the bus:</span><br>
            City Population Density: 30000 people per square mile <br>
            3% poeple commute by <span class="red"> car</span>  <br>
            95% people commute by <span class="blue"> bus</span> <br>
            2% people commute by foot <br>
            Your commute distance:
            <button id="button" type="button">Simulate!</button><br>
            <br>
            On average it will take:
            <br>
            a car <span class="red" id="averageCar"> </span> minutes
            <br>
            a bus <span class="red" id="averageBus"> </span> minutes
            <br>
            a pedestrian <span class="red" id="averageWalk"> </span> minutes
            <br>
            to commute from home to work.
            <br>
            Average commuteTime for the city is <span class="red" id="averageCity"> </span> minutes
            <br>
        </p>
        <div class= "graph-width">
        <div class = "column-left">
          <canvas id="bar" width="400" height="400"></canvas>
        </div>
        <div id = "column-right">
          <canvas id="graph" width="400" height="400"></canvas>
        </div>
      </div>



        <p>
            <span class="subtitle">Try simulating your own city:</span><br>
            City Population Density: <label for="pop"></label><input id="population" type="range" min="1000" max="100000" value="30000" id="pop"
            step="1" oninput="outputUpdate(value)"> <output for="pop" id="pLabel">30000</output>
            people per square mile <br>
            <input id="carper" type="number" step="1" value ="90" max = "98" min = "1">% poeple commute by <span class="red"> car</span>,
            <input id="busper" type="number" step="1" value ="5" max = "98" min = "1">% people commute by <span class="blue"> bus</span>, and
            <input id="walkper" type="number" step="1" value ="5" max = "98" min = "1">% people commute by foot.
            <br> <br>
            <span class="green">
            Your commute distance is
            <input id="mainDist" type="number" step="1" value ="10" max = "20" min = "1"> miles and
            your commute method is
            <select name="method" id="mainMethod">
                <option value="1">Car</option>
                <option value="2">Bus</option>
              </select><br>
            </span>

            <button id="button" type="button">Simulate!</button> <br><br>

            <br>

            Your commute time: <span class="red" id="mainTime"> </span> minutes<br>
            On average it will take
            a car <span class="red" id="averageCar"> </span> minutes,
            a bus <span class="red" id="averageBus"> </span> minutes, and
            a pedestrian <span class="red" id="averageWalk"> </span> minutes
            to commute from home to work.

            <br>
        </p>
        <div class = "graph-width">
        <div class = "column-left">
          <canvas id="bar" width="400" height="400"></canvas>
        </div>
        <div id = "column-right">
          <canvas id="graph" width="400" height="400"></canvas>
        </div>
      </div>

        <p>
            <span class="subtitle">Conclusion:</span><br>
              As you can see if more percentage of people commute by car,
              then the roads will be more crowded,
              making the average commute time of of both buses and cars increase.
              The <a href="https://www.washingtonpost.com/business/2019/10/07/nine-days-road-average-commute-time-reached-new-record-last-year/">
              graph</a> below shows the average commute time from the past 40 years,
              we can see that on average Americans are taking more time to commute.
              Could it be because more people are driving to work?
        </p>
        </div>

        <div class="picture">
          <img src="graph.jpg" alt="Commute Graph">
        </div>


        <script>
            "use strict";

            const simpleButton = document.getElementById("simpleButton");
            const canvasSmall = document.getElementById("graph_intro");
            const ctxSmall = canvasSmall.getContext('2d');

            const widthSmall = canvasSmall.width;
            const heightSmall = canvasSmall.height;

            const block_x_small = 6;
            const block_y_small = 6;
            const block_width_small = widthSmall/block_x_small;
            const block_height_small = heightSmall/block_y_small;

            class OneCar {
                constructor() {
                    this.x_init = 1;
                    this.y_init = 1;
                    this.x_end = 5;
                    this.y_end = 5;
                    this.spawn_time = 0;
                    this.move_time = this.spawn_time;
                    this.arrived = false;
                }
            }

            var person = new OneCar();
            var timeSmall=  0;
            var intervalIdSmall = null;
            var blocksSmall = [];

            ctxSmall.clearRect(0,0,widthSmall,heightSmall);
            ctxSmall.fillStyle = '#000000';
            ctxSmall.fillRect(0,0,widthSmall,heightSmall);

            function renewBlockSmall () {
                blocksSmall = [];
                for(var i = 0; i < block_x_small; i++) {
                    blocksSmall.push([]);
                    for(var j = 0; j < block_y_small; j++) {
                        blocksSmall[i].push(0);
                    }
                }
                blocksSmall[5][5] = -100;
            }

            function initSmall (){
                person = new OneCar();
                timeSmall = 0;
                intervalIdSmall = null;
                renewBlockSmall();
            }

            function displaySmall() {
                for(var i = 0; i < block_x_small; i++) {
                    for(var j = 0; j < block_y_small; j++) {
                        if(blocksSmall[i][j] == 0 ) {
                            ctxSmall.fillStyle = '#ffffff';
                            // ctx.fillRect(i*block_width,j*block_width,0.9*block_width,0.9*block_width);
                            ctxSmall.fillRect((i+0.45)*block_width_small,j*block_height_small,0.1*block_width_small,block_height_small);
                            ctxSmall.fillRect(i*block_width_small,(j+0.45)*block_height_small,block_width_small,0.1*block_height_small);
                        } else if (blocksSmall[i][j] <0 ) {
                            ctxSmall.fillStyle = '#FF1493';
                            ctxSmall.fillRect((i+0.45)*block_width_small,j*block_height_small,0.1*block_width_small,block_height_small);
                            ctxSmall.fillRect(i*block_width_small,(j+0.45)*block_height_small,block_width_small,0.1*block_height_small);
                        }
                        else {
                            ctxSmall.fillStyle = '#FF0000';
                            ctxSmall.fillRect((i+0.45)*block_width_small,j*block_height_small,0.1*block_width_small,block_height_small);
                            ctxSmall.fillRect(i*block_width_small,(j+0.45)*block_height_small,block_width_small,0.1*block_height_small);
                        }
                    }
                }
            }

            function updateSmall () {
                if (person.arrived) {
                    clearInterval(intervalIdSmall);
                }
                else{
                    if (person.spawn_time == timeSmall) {
                        if(!person.arrived) {
                            person.move_time = person.move_time + 1;
                            blocksSmall[person.x_init][person.y_init]++;
                        } else {
                            person.arrived = true;
                        }
                    } else if (person.move_time == timeSmall ) {
                        blocksSmall[person.x_init][person.y_init]--;
                        move(person);
                        if(!person.arrived) {
                            person.move_time = person.move_time + 1;
                            blocksSmall[person.x_init][person.y_init]++;
                        } else {
                            person.arrived = true;
                        }

                    }
                }
                timeSmall++;
                displaySmall();
            }

            function simulateSmall () {
                initSmall();
                intervalIdSmall = setInterval(updateSmall, 200);
            }

            simpleButton.addEventListener("click", simulateSmall);


            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------
            // ------------------------------------------------------------------------------










            function outputUpdate(plabel) {
                document.querySelector('#pLabel').value = plabel;
            }

            const button = document.getElementById("button");
            const populationButton = document.getElementById("population");
            var population = populationButton.value;

            const carperButton = document.getElementById("carper");
            var carper = carperButton.value;
            const walkperButton = document.getElementById("walkper");
            var walkper = walkperButton.value;
            const busperButton = document.getElementById("busper");
            var busper = busperButton.value;

            const averageCar = document.getElementById("averageCar");
            const averageBus = document.getElementById("averageBus");
            const averageWalk = document.getElementById("averageWalk");
            const mainTime = document.getElementById("mainTime");

            const mainDistButton = document.getElementById("mainDist");
            var mainDist = mainDistButton.value;
            //make mainMethod a drop down menu
            const mainMethodButton = document.getElementById("mainMethod");
            var mainMethodNum = mainMethodButton.value;



            var blocks = [];
            var cars = [];
            var bus  = [];
            var walk = [];
            const block_x = 70;
            const block_y = 70;
            var time = 0;
            const stop_spawn = 120;
            var intervalId = null;

            class Car {
                constructor(main = false) {
                    if (main) {
                        var [res, work] = findMainBuildings();
                    }
                    else{
                        var [res, work] = getResWork();
                    }
                    this.x_init = res.x;
                    this.y_init = res.y;
                    this.x_end = work.x;
                    this.y_end = work.y;
                    this.commute_time = 0;
                    this.spawn_time = Math.floor(Math.random() * stop_spawn);
                    this.move_time = this.spawn_time;
                    this.arrived = false;
                    this.main = main;
                }
            }

            class Bus {
                constructor(main = false) {
                    if (main) {
                        var [res, work] = findMainBuildings();
                    }
                    else{
                        var [res, work] = getResWork();
                    }
                    this.x_init = res.x;
                    this.y_init = res.y;
                    this.x_end = work.x;
                    this.y_end = work.y;
                    this.commute_time = 0;
                    this.spawn_time = Math.floor(Math.random() * stop_spawn);
                    this.move_time = this.spawn_time;
                    this.arrived = false;
                    this.main = main;
                }
            }

            class Walk {
                constructor(main = false) {
                    if (main) {
                        var [res, work] = findMainBuildings();
                    }
                    else{
                        var [res, work] = getRandomWalkPair();
                    }
                    this.x_init = res.x;
                    this.y_init = res.y;
                    this.x_end = work.x;
                    this.y_end = work.y;
                    this.commute_time = 0;
                    this.spawn_time = Math.floor(Math.random() * stop_spawn);
                    this.move_time = this.spawn_time;
                    this.arrived = false;
                    this.main = main;
                }
            }

            class BuildingRes {
                constructor(numPeople, x = 0, y = 0) {
                    if (x != 0 && y != 0) {
                        this.x = x;
                        this.y = y;
                    }
                    else{
                        this.x = Math.floor(Math.random() * block_x)  ;
                        this.y = Math.floor(Math.random() * block_y) ;
                    }
                    this.numPeople = numPeople;
                    this.currNumPeople = 0;
                }
            }

            class BuildingWork {
                constructor(numPeople, x = 0, y = 0) {
                    if (x != 0 && y != 0) {
                        this.x = x;
                        this.y = y;
                    }
                    else{
                    this.x = Math.floor(Math.random() * (Math.floor(block_x * 2 / 3)) +  Math.floor(block_x * 1 / 6))  ;
                    this.y = Math.floor(Math.random() * (Math.floor(block_y * 2 / 3)) +  Math.floor(block_x * 1 / 6))  ;
                    }
                    this.numPeople = numPeople;
                    this.currNumPeople = 0;
                }
            }

            function componentToHex(c) {
                var hex = c.toString(16);
                return hex.length == 1 ? "0" + hex : hex;
            }

            function rgbToHex(r, g, b) {
                return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
            }

            var resList = [];
            var workList = [];
            var walkPairs = [];

            function getResList(){
                var resPopulation = population;
                resList = [];
                if (resPopulation > 1) {
                    resList.push(new BuildingRes(1, Math.floor(10 + Math.random() * 5), Math.floor(10 + Math.random() * 5)));
                    resPopulation -= 1;
                }
                while(resPopulation > 20) {
                    const currNum = Math.floor(Math.random()*(80) + 20)
                    resList.push(new BuildingRes(currNum));
                    resPopulation -= currNum;
                }
                resList.push(new BuildingRes(resPopulation));
                return;
            }

            function getWorkList(){
                var workPopulation = population;
                workList = [];
                var mainRes = resList[0];
                console.log(mainRes.x);
                var mainX = Math.floor((mainDist * 2) + mainRes.x + Math.random() * 10);
                var mainY = Math.floor((mainDist * 2) + mainRes.y + Math.random() * 10);
                workList.push(new BuildingWork(1, mainX, mainY));
                while(workPopulation > 50) {
                    const currNum = Math.floor(Math.random()*(150) + 50)
                    workList.push(new BuildingWork(currNum));
                    workPopulation -= currNum;
                }
                workList.push(new BuildingWork(workPopulation));
                return;
            }


            function getWalkingDistancePairs(){
                walkPairs = [];
                for (var i = 0; i < resList.length; i ++) {
                    for (var j = 0; j < workList.length; j++) {
                        var currRes = resList[i];
                        var currWork = workList[j];
                        if (Math.abs(currRes.x - currWork.x) < 8 && Math.abs(currRes.y - currWork.y) < 8) {
                            walkPairs.push([currRes, currWork]);
                        }
                    }
                }
                var [firstRes, firstWork] = walkPairs[0];
                return;
            }


            function getRandomBuilding(L) {
                var curr = L[0];
                while(true) {
                    curr = L[Math.floor(Math.random()*L.length)];
                    if (curr.currNumPeople < curr.numPeople) {
                        curr.currNumPeople ++;
                        break;
                    }
                }
                return curr;
            }

            function getRandomWalkPair() {
                var [currRes, currWork] = walkPairs[0];
                while(true) {
                    [currRes, currWork] = walkPairs[Math.floor(Math.random()*walkPairs.length)];
                    if (currRes.currNumPeople < currRes.numPeople && currWork.currNumPeople < currWork.numPeople) {
                        currRes.currNumPeople ++;
                        currWork.currNumPeople ++;
                        break;
                    }
                }
                return [currRes, currWork];
            }

            function getResWork(){
                var currRes = getRandomBuilding(resList);
                var currWork = getRandomBuilding(workList);
                return [currRes, currWork];
            }

            function renewBlock () {
                blocks = [];
                for(var i = 0; i < block_x; i++) {
                    blocks.push([]);
                    for(var j = 0; j < block_y; j++) {
                        blocks[i].push(0);
                    }
                }
            }

            const canvas = document.getElementById("graph");
            const ctx = canvas.getContext('2d');

            const width = canvas.width;
            const height = canvas.height;
            const block_width = width/block_x;
            const block_height = height/block_y;

            ctx.clearRect(0,0,width,height);
            ctx.fillStyle = '#000000';
            ctx.fillRect(0,0,width,height);



            function display() {
                var maxRow = blocks.map(function(row){ return Math.max.apply(Math, row); });
                var max = Math.max.apply(null, maxRow);
                function ReLu(x) {
                    if(x <0) {
                        return 0;
                    } else {
                        return x;
                    }
                }

                for(var i = 0; i < block_x; i++) {
                    for(var j = 0; j < block_y; j++) {
                        if(blocks[i][j] == 0 ) {
                            ctx.fillStyle = '#ffffff';
                            // ctx.fillRect(i*block_width,j*block_width,0.9*block_width,0.9*block_width);
                            ctx.fillRect((i+0.45)*block_width,j*block_height,0.1*block_width,block_height);
                            ctx.fillRect(i*block_width,(j+0.45)*block_height,block_width,0.1*block_height);
                        } else {
                            ctx.fillStyle = rgbToHex(255,Math.floor(ReLu(255*(1-blocks[i][j]*block_x*block_y/cars.length))),Math.floor(ReLu(255*(1-blocks[i][j]*block_x*block_y/cars.length))));
                            ctx.fillRect((i+0.45)*block_width,j*block_height,0.1*block_width,block_height);
                            ctx.fillRect(i*block_width,(j+0.45)*block_height,block_width,0.1*block_height);
                        }
                    }
                }

                for (var b = 0; b < bus.length; b++) {
                    if (!bus[b].arrived && bus[b].spawn_time < time) {
                        var i = bus[b].x_init;
                        var j = bus[b].y_init;
                        ctx.fillStyle = '#0000ff';
                        ctx.fillRect((i+0.45)*block_width,j*block_height,0.1*block_width,block_height);
                        ctx.fillRect(i*block_width,(j+0.45)*block_height,block_width,0.1*block_height);
                    }
                }

                //drawing main, very stupid
                if (mainMethodNum == 1){
                    var currMain = cars[0];
                    console.log("yes");
                    var i = currMain.x_init;
                    var j = currMain.y_init;
                    ctx.fillStyle = '#00ff00';
                    ctx.fillRect(i*block_width,j*block_width,1*block_width,1*block_width);
                }

                if (mainMethodNum == 2){
                    var currMain = bus[0];
                    console.log("yes");
                    var i = currMain.x_init;
                    var j = currMain.y_init;
                    ctx.fillStyle = '#00ff00';
                    ctx.fillRect(i*block_width,j*block_width,1*block_width,1*block_width);
                }

                if (mainMethodNum == 3){
                    var currMain = walk[0];
                    console.log("yes");
                    var i = currMain.x_init;
                    var j = currMain.y_init;
                    ctx.fillStyle = '#00ff00';
                    ctx.fillRect(i*block_width,j*block_width,1*block_width,1*block_width);
                }

                //display buildings
                for (var b = 0; b < workList.length; b++) {
                    var i = workList[b].x;
                    var j = workList[b].y;
                    ctx.fillStyle = '#FF1493';
                    ctx.fillRect((i+0.45)*block_width,j*block_height,0.1*block_width,block_height);
                    ctx.fillRect(i*block_width,(j+0.45)*block_height,block_width,0.1*block_height);

                }
            }

            function deleteBuildings() {
                for (var b = 0; b < workList.length; b++) {
                    var i = workList[b].x;
                    var j = workList[b].y;
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect((i+0.45)*block_width,j*block_height,0.1*block_width,block_height);
                    ctx.fillRect(i*block_width,(j+0.45)*block_height,block_width,0.1*block_height);

                }
            }
            function findMainBuildings(){
                return [resList[0], workList[0]];
            }

            function init (){
                time = 0;
                cars = [];
                bus = [];
                walk = [];
                intervalId = null;
                population = populationButton.value;
                carper = carperButton.value;
                busper = busperButton.value;
                walkper = walkperButton.value;
                renewBlock();

                deleteBuildings();
                getResList();
                getWorkList();
                getWalkingDistancePairs();

                if (mainMethodNum == 3) {
                    const mainChar = new Walk(true);
                    walk.push(mainChar);
                }

                if (mainMethodNum == 1) {
                    const mainChar = new Car(true);
                    cars.push(mainChar);
                }

                if (mainMethodNum == 2) {
                    const mainChar = new Bus(true);
                    walk.push(mainChar);
                }

                for(var c = 0; c < Math.floor(population * walkper / 100); c++) {
                    const walker = new Walk();
                    walk.push(walker);
                }


                for(var c = 0; c < Math.floor(population * carper / 100); c++) {
                    const driver = new Car();
                    cars.push(driver);
                }

                for(var c = 0; c < Math.floor(population * busper / 100 / 40); c++) {
                    const busDriver = new Bus();
                    bus.push(busDriver);
                }


            }

            function terminate() {

                for (var i = 0; i < cars.length; i++) {
                    if (cars[i].arrived == false) {
                        return false;
                    }
                }
                for (var i = 0; i < bus.length; i++) {
                    if (bus[i].arrived == false) {
                        return false;
                    }
                }
                for (var i = 0; i < walk.length; i++) {
                    if (walk[i].arrived == false) {
                        return false;
                    }
                }
                return true;
            }

            // function move(car) {
            //     if(!arriveX(car)) {
            //         if(car.x_end < car.x_init) {
            //             car.x_init--;
            //         } else {
            //             car.x_init++;
            //         }
            //     } else if (!arriveY(car)) {
            //         if(car.y_end < car.y_init) {
            //             car.y_init--;
            //         } else {
            //             car.y_init++;
            //         }
            //     }
            // }

            function move(car) {
                if(!arriveX(car) && !arriveY(car)) {
                    if (Math.random()<0.5) {
                        if(car.x_end < car.x_init) {
                            car.x_init--;
                        } else {
                            car.x_init++;
                        }
                    } else {
                        if(car.y_end < car.y_init) {
                        car.y_init--;
                        } else {
                            car.y_init++;
                        }
                    }
                } else if (!arriveX(car)) {
                    if(car.x_end < car.x_init) {
                        car.x_init--;
                    } else {
                        car.x_init++;
                    }
                } else if (!arriveY(car)) {
                    if(car.y_end < car.y_init) {
                        car.y_init--;
                    } else {
                        car.y_init++;
                    }
                }
            }

            function traffic(i,j)  {
                var b = blocks[i][j];
                return Math.floor((b)/10) + 1;
            }

            function arriveX(car) {
                return car.x_init == car.x_end;
            }

            function arriveY(car) {
                return car.y_init == car.y_end;
            }

            function arrived(car) {
                return arriveX(car) && arriveY(car);
            }

            function findCarCommuteTime() {
                var sum = 0;
                for (var i = 0; i < cars.length; i++) {
                    sum = sum + cars[i].commute_time;
                }
                return sum/cars.length/2;
            }
            function findBusCommuteTime() {
                var sum = 0;
                for (var i = 0; i < bus.length; i++) {
                    sum = sum + bus[i].commute_time;
                }
                return sum/bus.length/2+10;
            }
            function findWalkCommuteTime() {
                var sum = 0;
                for (var i = 0; i < walk.length; i++) {
                    sum = sum + walk[i].commute_time;
                }
                return sum/walk.length/2*4;
            }

            function update () {
                    if (terminate()) {
                        if (cars.length != 0) {
                            averageCar.innerText = parseFloat(findCarCommuteTime()).toFixed(2);
                        } else {
                            averageCar.innerText = "N/A";
                        }
                        if (bus.length != 0) {
                            averageBus.innerText = parseFloat(findBusCommuteTime()).toFixed(2);
                        } else {
                            averageBus.innerText = "N/A";
                        }
                        if (walk.length != 0) {
                            averageWalk.innerText = parseFloat(findWalkCommuteTime()).toFixed(2);
                        } else {
                            console.log("wtf");
                            averageWalk.innerText = "N/A";
                        }
                        if (mainMethodNum == 1) {
                            mainTime.innerText = parseFloat((cars[0]).commute_time).toFixed(2);
                        }
                        if (mainMethodNum == 2) {
                            mainTime.innerText = parseFloat((bus[0]).commute_time).toFixed(2);
                        }
                        if (mainMethodNum == 3) {
                            mainTime.innerText = parseFloat((walk[0]).commute_time).toFixed(2);
                        }
                        drawGraph();
                        clearInterval(intervalId);
                    }
                    else{
                        for(var i = 0; i < cars.length; i++) {
                            if (cars[i].spawn_time == time) {
                                if(!arrived(cars[i])) {
                                    cars[i].move_time = cars[i].move_time + traffic(cars[i].x_init, cars[i].y_init);
                                    cars[i].commute_time = cars[i].commute_time + traffic(cars[i].x_init, cars[i].y_init);
                                    blocks[cars[i].x_init][cars[i].y_init]++;
                                } else {
                                    cars[i].arrived = true;
                                }
                            } else if (cars[i].move_time == time ) {
                                blocks[cars[i].x_init][cars[i].y_init]--;
                                move(cars[i]);
                                if(!arrived(cars[i])) {
                                    cars[i].move_time = cars[i].move_time + traffic(cars[i].x_init, cars[i].y_init);
                                    cars[i].commute_time = cars[i].commute_time + traffic(cars[i].x_init, cars[i].y_init);
                                    blocks[cars[i].x_init][cars[i].y_init]++;
                                } else {
                                    cars[i].arrived = true;
                                }

                            }
                        }
                        for(var i = 0; i < bus.length; i++) {
                            if (bus[i].spawn_time == time) {
                                if(!arrived(bus[i])) {
                                    bus[i].move_time = bus[i].move_time + traffic(bus[i].x_init, bus[i].y_init);
                                    bus[i].commute_time = bus[i].commute_time + traffic(bus[i].x_init, bus[i].y_init);
                                    blocks[bus[i].x_init][bus[i].y_init]++;
                                } else {
                                    bus[i].arrived = true;
                                }
                            } else if (bus[i].move_time == time ) {
                                blocks[bus[i].x_init][bus[i].y_init]--;
                                move(bus[i]);
                                if(!arrived(bus[i])) {
                                    bus[i].move_time = bus[i].move_time + traffic(bus[i].x_init, bus[i].y_init);
                                    bus[i].commute_time = bus[i].commute_time + traffic(bus[i].x_init, bus[i].y_init);
                                    blocks[bus[i].x_init][bus[i].y_init]++;
                                } else {
                                    bus[i].arrived = true;
                                }

                            }
                        }

                        for(var i = 0; i < walk.length; i++) {
                            if (walk[i].spawn_time == time) {
                                if(!arrived(walk[i])) {
                                    walk[i].move_time = walk[i].move_time + 1;
                                    walk[i].commute_time = walk[i].commute_time + 1;
                                } else {
                                    walk[i].arrived = true;
                                }
                            } else if (walk[i].move_time == time ) {
                                move(walk[i]);
                                if(!arrived(walk[i])) {
                                    walk[i].move_time = walk[i].move_time + 1;
                                    walk[i].commute_time = walk[i].commute_time + 1;
                                } else {
                                    walk[i].arrived = true;
                                }

                            }
                        }

                        time++;
                        display();
                    }
            }

            function simulate () {
                init();
                intervalId = setInterval(update, 40 * (30000 / population));
            }

            button.addEventListener("click", simulate);

            const canvas1 = document.getElementById('bar');
            const ctx1 = canvas1.getContext('2d');
            const width1 = canvas1.width;
            const height1 = canvas1.height;
            ctx1.fillStyle = "#000000";
            ctx1.fillRect(0,0,width1,height1);

            function drawBar(ctx, x, y, width, height, color){
              ctx.save();
              ctx.fillStyle=color;
              ctx.fillRect(x,y,width,height);
              ctx.restore();
            }

            function drawLine(ctx, x0, y0, x1, y1, color){
              ctx.save();
              ctx.strokeStyle = color;
              ctx.beginPath();
              ctx.moveTo(x0,y0);
              ctx.lineTo(x1,y1);
              ctx.stroke();
              ctx.restore();
            }

            function drawText(ctx, x, y, text, color, align, size, font) {
              ctx.save();
              ctx.fillStyle = color;
              ctx.textAlign = align;
              ctx.font = String(size) + "px " + font;
              ctx.fillText(text, x, y);
              ctx.restore();
            }

            function drawGraph() {
              // initialize
              drawBar(ctx1, 0,0,width1, height1, "black");
              // calculate variables
              var carTime = findCarCommuteTime();
              var busTime = findBusCommuteTime();
              var xMax = Math.ceil(Math.max(carTime, busTime)/5) * 5;
              var margin = width1/10;
              var ticker = (height1 - (2*margin))/xMax;
              // draw axis
              drawLine(ctx1,margin, height1 - margin, margin, margin, "white");
              drawLine(ctx1,margin, height1 - margin, width1-margin, height1-margin, "white");
              // draw tickers
              for (var t = 0; t <= xMax; t += 5) {
                var y = (height1 - margin) - t*ticker;
                if (t != 0) {
                  drawLine(ctx1, margin, y, width1-margin, y, "grey");
                }
                drawText(ctx1,margin*2/3, y , String(t), "white", "center", 10, "Arial");
              }
              // calculate bus and bar
              var carY = (height1 - margin) - carTime*ticker;
              var busY = (height1 - margin) - busTime*ticker;
              var xDif = (width1 - (2*margin))/ 10;
              // calculate average commute
              var avgTime = carTime * parseInt(carper)/100 + busTime * parseInt(busper)/100;
              console.log(carTime, carper, busTime, busper, avgTime);
              var avgY = (height1 - margin) - avgTime*ticker;
              // bus Bar
              drawBar(ctx1, margin + xDif, busY, 2*xDif, busTime*ticker, "blue");
              drawText(ctx1,margin + 2*xDif, height1 - margin/2 , "Bus", "white", "center", 25, "Arial");
              // car Bar
              drawBar(ctx1, margin + 4*xDif, carY, 2*xDif, carTime*ticker, "red");
              drawText(ctx1,margin + 5*xDif, height1 - margin/2 , "Car", "white", "center",25, "Arial");
              // avg Bar
              drawBar(ctx1, margin + 7*xDif, avgY, 2*xDif, avgTime*ticker, "yellow");
              drawText(ctx1,margin + 8*xDif, height1 - margin/2 , "Avg", "white", "center",25, "Arial");

            }

            // const canvas2 = document.getElementById('compare');
            // const ctx2 = canvas2.getContext('2d');
            // const width2 = canvas2.width;
            // const height2 = canvas2.height;
            // ctx2.fillStyle = "#000000";
            // ctx2.fillRect(0,0,width2,height2);
            //
            // // https://www.titlemax.com/discovery-center/planes-trains-and-automobiles/100-u-s-cities-ranked-by-commute-time/
            // const commuteTime = [36.3,34.6,32.8,32.1,32,31.6,31.4,31,30.8,30.4,
            //   30.1,30,29.7,29.5,29.1,28.9,28.4,28.2,28.2,28.1,27.7,27.5,27.3,27.2,
            //   27.1,26.8,26.8,26.8,26.7,26.6,26.6,26.6,26.5,26.5,26.2,26.2,26,26,
            //   25.9,25.8,25.8,25.7,25.6,25.4,25.4,25.3,25.2,24.9,24.8,24.8,24.7,
            //   24.6,24.5,24.5,24.5,24.4,24.3,24.1,23.9,23.9,23.8,23.7,23.7,23.7,
            //   23.6,23.4,23.4,23.4,23.4,23.4,23.3,23.2,23.1,23.1,23.1,23,22.9,
            //   22.9,22.8,22.8,22.7,22.5,22.4,22.4,22.4,22,21.9,21.8,21.8,21.7,
            //   21.5,21.5,21.4,21.3,21.3,21.2,20.7,20.3,20.2,19.5];
            //
            // const cities =
            // ["New York-Newark-Jersey City, NY-NJ","Washington-Arlington-Alexandria, DC-VA",
            // "San Francisco-Oakland-Hayward, CA","Riverside-San Bernardino-Ontario, CA",
            // "Stockton-Lodi, CA","Chicago-Naperville-Elgin, IL","Atlanta-Sandy Springs-Roswell, GA",
            // "Boston-Cambridge-Newton, MA","Baltimore-Columbia-Towson, MD","Bridgeport-Stamford-Norwalk, CT",
            // "Seattle-Tacoma-Bellevue, WA","Los Angeles-Long Beach-Anaheim, CA","Houston-The Woodlands-Sugar Land, TX",
            // "Philadelphia-Camden-Wilmington, PA-NJ-DE","Urban Honolulu, HI","Miami-Fort Lauderdale-West Palm Beach, FL",
            // "Worcester, MA","Orlando-Kissimmee-Sanford, FL","San Jose-Sunnyvale-Santa Clara, CA",
            // "Dallas-Fort Worth-Arlington, TX","Allentown-Bethlehem-Easton, PA","Denver-Aurora-Lakewood, CO",
            // "Nashville-Davidson-Murfreesboro-Franklin, TN","Cape Coral-Fort Myers, FL","Tampa-St. Petersburg-Clearwater, FL",
            // "Detroit-Warren-Dearborn, MI","Austin-Round Rock, TX","Sacramento-Roseville-Arden-Arcade, CA",
            // "Pittsburgh, PA","Portland-Vancouver-Hillsboro, OR-WA","Oxnard-Thousand Oaks-Ventura, CA",
            // "Baton Rouge, LA","Charlotte-Concord-Gastonia, NC","Jacksonville, FL","Phoenix-Mesa-Scottsdale, AZ",
            // "Birmingham-Hoover, AL","San Antonio-New Braunfels, TX","Lakeland-Winter Haven, FL",
            // "Raleigh, NC","Providence-Warwick, RI","New Orleans-Metairie, LA","San Diego-Carlsbad, CA",
            // "St. Louis, MO","Charleston-North Charleston, SC","Deltona-Daytona Beach-Ormond Beach, FL",
            // "Minneapolis-St. Paul-Bloomington, MN","Richmond, VA","New Haven-Milford, CT","Indianapolis-Carmel-Anderson, IN",
            // "Portland-South Portland, ME","Cincinnati, OH","Cleveland-Elyria, OH","Las Vegas-Henderson-Paradise, NV",
            // "Tucson, AZ","North Port-Sarasota-Bradenton, FL","Jackson, MS","Virginia Beach-Norfolk-Newport News, VA",
            // "Memphis, TN","Louisville/Jefferson County, KY","Hartford-West Hartford-East Hartford, CT",
            // "Durham-Chapel Hill, NC","Columbus, OH","Columbia, SC","Augusta-Richmond County, GA",
            // "Knoxville, TN","Albuquerque, NM","El Paso, TX","Akron, OH","Bakersfield, CA",
            // "Winston-Salem, NC","Colorado Springs, CO","Chattanooga, TN","Milwaukee-Waukesha-West Allis, WI",
            // "Albany-Schenectady-Troy, NY","Lancaster, PA","Kansas City, MO-KS","Little Rock-North Little Rock-Conway, AR",
            // "Harrisburg-Carlisle, PA","Greenville-Anderson-Mauldin, SC","Springfield, MA","Oklahoma City, OK",
            // "Ogden-Clearfield, UT","Salt Lake City, UT","Fresno, CA","Greensboro-High Point, NC",
            // "Boise City, ID","McAllen-Edinburg-Mission, TX","Grand Rapids-Wyoming, MI","Scranton-Wilkes-Barre-Hazleton, PA",
            // "Madison, WI","Buffalo-Cheektowaga-Niagara Falls, NY","Tulsa, OK","Provo-Orem, UT","Rochester, NY",
            // "Dayton, OH","Syracuse, NY","Toledo, OH","Des Moines-West Des Moines, IA","Omaha-Council Bluffs, NE-IA","Wichita, KS"];

        </script>
    </body>
</html>
