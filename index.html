<!doctype html>
<html>
    <head>
        <meta charset="utf8">
        <title>Commute Time</title>
        <style>
            /* This is CSS */
            body {
                margin: 0;
                padding: 0;
                color:#000;
                background: #A9A9A9;
                font-size:120%;
            }

            h1 {
                margin-top: 0;
                color:rgb(58, 58, 58);
                background: rgb(1, 197, 159);
                top: 0;
                text-align: center ;
                background-size: 100%;
            }
            h.bigger {
                font-size:150%;
                text-decoration: underline;
            }
            p {
                text-align: center;
            }

            p2 {
                text-align: center;
            }

            .red {
                color: #df0000;
            }
            .green { /* OK, a bit contrived... */
                color: #00FF00;
            }
            .brown { /* OK, a bit contrived... */
                color: #964B00;
            }
            .blue { /* OK, a bit contrived... */
                color: #0000ff;
            }
            .subtitle {
                font-size:140%;
                text-decoration: underline;
            }


            .column-left {
              float: right;

            }
            .column-right {
              margin-right: 100px;
              float: left;

            }

            .picture {
              margin: auto;
              max-width: 40%;
            }

            .center_text {
              position: absolute;
              left: 50%;
            }

            a:link {
              color: black;
              background-color: transparent;
              text-decoration: underline;
            }

            a:visited {
              color: black;
              background-color: transparent;
              text-decoration: none;
            }

            a:hover {
              color: black;
              background-color: transparent;
              text-decoration: underline;
            }

            a:active {
              color: black;
              background-color: transparent;
              text-decoration: underline;
            }

            .max-width {
              max-width: 80%;
              margin: auto;
            }
            .min-width {
              max-width: 65%;
              margin: auto;
              text-align: center;
            }

            .graph-width {
              max-width: 75%;
              margin: auto;
            }

            .center-graph {
              margin: auto;
              max-width:35%;
            }
          }

        </style>
    </head>
    <body>
        <h1>
            <h class ="bigger">Commute Time Simulation:</h>
            <div>Understand how method of transporation affects commute time</div>
            <img src="commute.jpg" alt="commute">
        </h1>
        <div class="max-width">
        <p class = "min-width"> According to research by the <a href="https://oem.bmj.com/content/77/2/77">
          Finnish Institute for Health and Welfare</a>, longer commute time increases
          the risk of physical inactivity and sleep problems. Therefore, we want to
          explore how different methods of transportation affect total average
          commute time in a city.
          <br>
          <br>
        </p>

        <p class = "min-width">
            <span class="subtitle">How our simulation works:</span><br>
            <br>
            For each simulation, the percentage of people riding the <span class="red"> bus</span>,
            the percentage of people driving a <span class="blue">car</span>, and
            the percentage of people walking to work are specified. We are also
            making the assumption that the average distance to work for those
            walking to work is 1 mile. Lastly, <span class="brown">Brown</span> represent a workplace.
            <br>
            <br>
            <button id="simpleButton" type="button">Simulate!</button>
        </p>
        <p>
            <canvas id="graph_intro" width="500" height="200"></canvas>
        </p>


        <p>
            <span class="subtitle">Let's explore different ratios of transporation methods:</span><br>
            City Population Density: 30000 people per square mile <br>
            95% poeple commute by <span class="red"> car</span> <br>
            3% people commute by <span class="blue"> bus</span> <br>
            2% people commute by foot <br>

            <button id="button" type="button">Simulate!</button> <br>
            <br>
            On average it will take:
            <br>
            a car <span class="red" id="averageCar"> </span> minutes
            <br>
            a bus <span class="red" id="averageBus"> </span> minutes
            <br>
            a pedestrian <span class="red" id="averageWalk"> </span> minutes
            <br>
            to commute from home to work.
            <br>
            Average commuteTime for the city is <span class="red" id="averageCity"> </span> minutes
            <br>
        </p>
        <div class = "graph-width">
        <div class = "column-left">
          <canvas id="bar" width="400" height="400"></canvas>
        </div>
        <div id = "column-right">
          <canvas id="graph" width="400" height="400"></canvas>
        </div>
      </div>

        <p>
            <span class="subtitle">Let's see what happens when more people take the bus:</span><br>
            City Population Density: 30000 people per square mile <br>
            3% poeple commute by <span class="red"> car</span>  <br>
            95% people commute by <span class="blue"> bus</span> <br>
            2% people commute by foot <br>

            <button id="button2" type="button">Simulate!</button><br>
            <br>
            On average it will take:
            <br>
            a car <span class="red" id="averageCar2"> </span> minutes
            <br>
            a bus <span class="red" id="averageBus2"> </span> minutes
            <br>
            a pedestrian <span class="red" id="averageWalk2"> </span> minutes
            <br>
            to commute from home to work.
            <br>
            Average commuteTime for the city is <span class="red" id="averageCity2"> </span> minutes
            <br>
        </p>
        <div class= "graph-width">
        <div class = "column-left">
          <canvas id="bar2" width="400" height="400"></canvas>
        </div>
        <div id = "column-right">
          <canvas id="graph2" width="400" height="400"></canvas>
        </div>
      </div>

      <p>
          <span class="subtitle">Key Takeaways:</span><br>
          If you compare the result from the first simulation to the result of the
          second simulation, we see that the average commute time for the city
          decreased when more people took public transportation (car) rather than
          driving to work. According to the
          <a href="https://cleantechnica.com/2016/11/29/9641-annual-savings-taking-public-transportation-usa/#:~:text=The%20annual%20savings%20is%20%249%2C641,transit%20than%20in%20a%20car.">
          American Public Transportation Association</a>, individuals who ride public
          transport instead of driving save $803 a month on average.
          <br>
          <br>
          <div class="min-width">
            Let's take a look at monthly and annual savings when switching from
            driving to taking public transit to work for the 20 largest metro areas
            in United States.
          <br>
          <br>
          Choose a city:
          <select name="metrocity" id="metrocity">
          <option value="New York">New York</option>
          <option value="San Francisco">San Francisco</option>
          <option value="Boston">Boston</option>
          <option value="Philadelphia">Philadelphia</option>
          <option value="Seattle">Seattle</option>
          <option value="Chicago">Chicago</option>
          <option value="Honolulu">Honolulu</option>
          <option value="Los Angeles">Los Angeles</option>
          <option value="San Diego">San Diego</option>
          <option value="Portland">Portland</option>
          <option value="Minneapolis">Minneapolis</option>
          <option value="Baltimore">Baltimore</option>
          <option value="Denver">Denver</option>
          <option value="Washington, DC">Washington, DC</option>
          <option value="Pittsburgh">Pittsburgh</option>
          <option value="Cleveland">Cleveland</option>
          <option value="Miami">Miami</option>
          <option value="Atlanta">Atlanta</option>
          <option value="Las Vegas">Las Vegas</option>
          <option value="Dallas">Dallas</option>
          </select>
           . Percent of days taking public transit:
           <input type="number" id="transitPercent" value="100" min = "1", max = 100> %
          </div>
          <br>
            </p>
          <div class="center-graph">
            <canvas id="cityBar" width="400" height="400"></canvas>
          </div>


        <p>
            <span class="subtitle">Try simulating your own city:</span><br>
            City Population Density: <label for="pop"></label><input id="population" type="range" min="1000" max="100000" value="30000" id="pop"
            step="1" oninput="outputUpdate(value)"> <output for="pop" id="pLabel">30000</output>
            people per square mile <br>
            <input id="carper" type="number" step="1" value ="90" max = "98" min = "1">% poeple commute by <span class="red"> car</span><br>
            <input id="busper" type="number" step="1" value ="5" max = "98" min = "1">% people commute by <span class="blue"> bus</span><br>
            <input id="walkper" type="number" step="1" value ="5" max = "98" min = "1">% people commute by foot
            <br> <br>
            <span class="green">
            Your commute distance </span>is
            <input id="mainDist" type="number" step="1" value ="10" max = "20" min = "1"> miles and
            your commute method is
            <select name="method" id="mainMethod">
                <option value="1">Car</option>
                <option value="2">Bus</option>
                <option value="3">Walk</option>
              </select><br>


            <button id="button3" type="button">Simulate!</button><br>
            <br>

            Your commute time: <span class="red" id="mainTime"> </span> minutes
            <br>
            On average it will take:
            <br>
            a car <span class="red" id="averageCar3"> </span> minutes
            <br>
            a bus <span class="red" id="averageBus3"> </span> minutes
            <br>
            a pedestrian <span class="red" id="averageWalk3"> </span> minutes
            <br>
            to commute from home to work.
            <br>
            Average commuteTime for the city is <span class="red" id="averageCity3"> </span> minutes
            <br>
            <br>
        </p>
        <div class = "graph-width">
        <div class = "column-left">
          <canvas id="bar3" width="400" height="400"></canvas>
        </div>
        <div id = "column-right">
          <canvas id="graph3" width="400" height="400"></canvas>
        </div>
      </div>

        <p>
            <span class="subtitle">Conclusion:</span><br>
              As you can see if more percentage of people commute by car,
              then the roads will be more crowded,
              making the average commute time of of both buses and cars increase.
              The <a href="https://www.washingtonpost.com/business/2019/10/07/nine-days-road-average-commute-time-reached-new-record-last-year/">
              graph</a> below shows the average commute time from the past 40 years,
              we can see that on average Americans are taking more time to commute.
              Could it be because more people are driving to work?
        </p>
        </div>

        <div class="picture">
          <img src="graph.jpg" alt="Commute Graph">
        </div>


        <script>
            "use strict";
            const simpleButton = document.getElementById("simpleButton");
            const canvasSmall = document.getElementById("graph_intro");
            const ctxSmall = canvasSmall.getContext('2d');

            const widthSmall = canvasSmall.width;
            const heightSmall = canvasSmall.height;

            const block_x_small = 6;
            const block_y_small = 6;
            const block_width_small = widthSmall/block_x_small;
            const block_height_small = heightSmall/block_y_small;

            class OneCar {
                constructor() {
                    this.x_init = 1;
                    this.y_init = 1;
                    this.x_end = 5;
                    this.y_end = 5;
                    this.spawn_time = 0;
                    this.move_time = this.spawn_time;
                    this.arrived = false;
                }
            }

            var person = new OneCar();
            var timeSmall=  0;
            var intervalIdSmall = null;
            var blocksSmall = [];

            ctxSmall.clearRect(0,0,widthSmall,heightSmall);
            ctxSmall.fillStyle = '#000000';
            // ctxSmall.fillRect(0,0,widthSmall,heightSmall);

            function renewBlockSmall () {
                blocksSmall = [];
                for(var i = 0; i < block_x_small; i++) {
                    blocksSmall.push([]);
                    for(var j = 0; j < block_y_small; j++) {
                        blocksSmall[i].push(0);
                    }
                }
                blocksSmall[5][5] = -100;
            }

            function initSmall (){
                person = new OneCar();
                timeSmall = 0;
                intervalIdSmall = null;
                renewBlockSmall();
            }

            function displaySmall() {
                for(var i = 0; i < block_x_small; i++) {
                    for(var j = 0; j < block_y_small; j++) {
                        if(blocksSmall[i][j] == 0 ) {
                            ctxSmall.fillStyle = '#ffffff';
                            // ctx.fillRect(i*block_width,j*block_width,0.9*block_width,0.9*block_width);
                            ctxSmall.fillRect((i+0.45)*block_width_small,j*block_height_small,0.1*block_width_small,block_height_small);
                            ctxSmall.fillRect(i*block_width_small,(j+0.45)*block_height_small,block_width_small,0.1*block_height_small);
                        } else if (blocksSmall[i][j] <0 ) {
                            ctxSmall.fillStyle = '#964B00';
                            ctxSmall.fillRect((i+0.45)*block_width_small,j*block_height_small,0.1*block_width_small,block_height_small);
                            ctxSmall.fillRect(i*block_width_small,(j+0.45)*block_height_small,block_width_small,0.1*block_height_small);
                        }
                        else {
                            ctxSmall.fillStyle = '#FF0000';
                            ctxSmall.fillRect((i+0.45)*block_width_small,j*block_height_small,0.1*block_width_small,block_height_small);
                            ctxSmall.fillRect(i*block_width_small,(j+0.45)*block_height_small,block_width_small,0.1*block_height_small);
                        }
                    }
                }
            }

            function updateSmall () {
                if (person.arrived) {
                    clearInterval(intervalIdSmall);
                }
                else{
                    if (person.spawn_time == timeSmall) {
                        if(!person.arrived) {
                            person.move_time = person.move_time + 1;
                            blocksSmall[person.x_init][person.y_init]++;
                        } else {
                            person.arrived = true;
                        }
                    } else if (person.move_time == timeSmall ) {
                        blocksSmall[person.x_init][person.y_init]--;
                        move(person);
                        if(!person.arrived) {
                            person.move_time = person.move_time + 1;
                            blocksSmall[person.x_init][person.y_init]++;
                        } else {
                            person.arrived = true;
                        }

                    }
                }
                timeSmall++;
                displaySmall();
            }

            function simulateSmall () {
                initSmall();
                intervalIdSmall = setInterval(updateSmall, 200);
            }

            simpleButton.addEventListener("click", simulateSmall);

            const populationButton = document.getElementById("population");

            const carperButton = document.getElementById("carper");
            const busperButton = document.getElementById("busper");
            const walkperButton = document.getElementById("walkper");

            veryBigFunction ( false,"graph", "bar","button", 30000,95, 3,2,"averageCar", "averageBus", "averageWalk", "mainDist","mainTime","mainMethod","averageCity");
            veryBigFunction ( false,"graph2", "bar2","button2", 30000,3, 95,2,"averageCar2", "averageBus2", "averageWalk2", "mainDist","mainTime","mainMethod","averageCity2");
            veryBigFunction ( true,"graph3", "bar3","button3", populationButton.value,carperButton.value, busperButton.value,walkperButton.value,"averageCar3", "averageBus3", "averageWalk3", "mainDist","mainTime","mainMethod","averageCity3");

            function outputUpdate(plabel) {
                document.querySelector('#pLabel').value = plabel;
            }

            function drawBar(ctx, x, y, width, height, color){
              ctx.save();
              ctx.fillStyle=color;
              ctx.fillRect(x,y,width,height);
              ctx.restore();
            }

            function drawLine(ctx, x0, y0, x1, y1, color){
              ctx.save();
              ctx.strokeStyle = color;
              ctx.beginPath();
              ctx.moveTo(x0,y0);
              ctx.lineTo(x1,y1);
              ctx.stroke();
              ctx.restore();
            }

            function drawText(ctx, x, y, text, color, align, size, font) {
              ctx.save();
              ctx.fillStyle = color;
              ctx.textAlign = align;
              ctx.font = String(size) + "px " + font;
              ctx.fillText(text, x, y);
              ctx.restore();
            }


            function veryBigFunction ( freeControl,canvasName, barName, simulateButtonName, population,carper, busper,walkper,averageCarName, averageBusName, averageWalkName, mainDistName,mainTimeName,mainMethodName,averageTotalTimeName) {


            const canvas = document.getElementById(canvasName);

            const button = document.getElementById(simulateButtonName);

            const averageCar = document.getElementById(averageCarName);
            const averageBus = document.getElementById(averageBusName);
            const averageWalk = document.getElementById(averageWalkName);
            const averageTotalTime = document.getElementById(averageTotalTimeName);
            const mainTime = document.getElementById(mainTimeName);

            const mainDistButton = document.getElementById(mainDistName);
            var mainDist = mainDistButton.value;
            //make mainMethod a drop down menu
            const mainMethodButton = document.getElementById(mainMethodName);
            var mainMethodNum = mainMethodButton.value;

            const canvas1 = document.getElementById(barName);
            const ctx1 = canvas1.getContext('2d');
            const width1 = canvas1.width;
            const height1 = canvas1.height;
            ctx1.fillStyle = "#000000";
            // ctx1.fillRect(0,0,width1,height1);

            // const canvas = document.getElementById("graph");
            // const button = document.getElementById("button");
            // const populationButton = document.getElementById("population");
            // var population = populationButton.value;

            // const carperButton = document.getElementById("carper");
            // var carper = carperButton.value;
            // const walkperButton = document.getElementById("walkper");
            // var walkper = walkperButton.value;
            // const busperButton = document.getElementById("busper");
            // var busper = busperButton.value;

            // const averageCar = document.getElementById("averageCar");
            // const averageBus = document.getElementById("averageBus");
            // const averageWalk = document.getElementById("averageWalk");
            // const mainTime = document.getElementById("mainTime");

            // const mainDistButton = document.getElementById("mainDist");
            // var mainDist = mainDistButton.value;
            // //make mainMethod a drop down menu
            // const mainMethodButton = document.getElementById("mainMethod");
            // var mainMethodNum = mainMethodButton.value;




            var blocks = [];
            var cars = [];
            var bus  = [];
            var walk = [];
            const block_x = 70;
            const block_y = 70;
            var time = 0;
            const stop_spawn = 120;
            var intervalId = null;

            class Car {
                constructor(main = false) {
                    if (main) {
                        var [res, work] = findMainBuildings();
                    }
                    else{
                        var [res, work] = getResWork();
                    }
                    this.x_init = res.x;
                    this.y_init = res.y;
                    this.x_end = work.x;
                    this.y_end = work.y;
                    this.commute_time = 0;
                    this.spawn_time = Math.floor(Math.random() * stop_spawn);
                    this.move_time = this.spawn_time;
                    this.arrived = false;
                    this.main = main;
                }
            }

            class Bus {
                constructor(main = false) {
                    if (main) {
                        var [res, work] = findMainBuildings();
                    }
                    else{
                        var [res, work] = getResWork();
                    }
                    this.x_init = res.x;
                    this.y_init = res.y;
                    this.x_end = work.x;
                    this.y_end = work.y;
                    this.commute_time = 0;
                    this.spawn_time = Math.floor(Math.random() * stop_spawn);
                    this.move_time = this.spawn_time;
                    this.arrived = false;
                    this.main = main;
                }
            }

            class Walk {
                constructor(main = false) {
                    if (main) {
                        var [res, work] = findMainBuildings();
                    }
                    else{
                        var [res, work] = getRandomWalkPair();
                    }
                    this.x_init = res.x;
                    this.y_init = res.y;
                    this.x_end = work.x;
                    this.y_end = work.y;
                    this.commute_time = 0;
                    this.spawn_time = Math.floor(Math.random() * stop_spawn);
                    this.move_time = this.spawn_time;
                    this.arrived = false;
                    this.main = main;
                }
            }

            class BuildingRes {
                constructor(numPeople, x = 0, y = 0) {
                    if (x != 0 && y != 0) {
                        this.x = x;
                        this.y = y;
                    }
                    else{
                        this.x = Math.floor(Math.random() * block_x)  ;
                        this.y = Math.floor(Math.random() * block_y) ;
                    }
                    this.numPeople = numPeople;
                    this.currNumPeople = 0;
                }
            }

            class BuildingWork {
                constructor(numPeople, x = 0, y = 0) {
                    if (x != 0 && y != 0) {
                        this.x = x;
                        this.y = y;
                    }
                    else{
                    this.x = Math.floor(Math.random() * (Math.floor(block_x * 2 / 3)) +  Math.floor(block_x * 1 / 6))  ;
                    this.y = Math.floor(Math.random() * (Math.floor(block_y * 2 / 3)) +  Math.floor(block_x * 1 / 6))  ;
                    }
                    this.numPeople = numPeople;
                    this.currNumPeople = 0;
                }
            }

            function componentToHex(c) {
                var hex = c.toString(16);
                return hex.length == 1 ? "0" + hex : hex;
            }

            function rgbToHex(r, g, b) {
                return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
            }

            var resList = [];
            var workList = [];
            var walkPairs = [];

            function getResList(){
                var resPopulation = population;
                resList = [];
                if (resPopulation > 1) {
                    resList.push(new BuildingRes(1, Math.floor(10 + Math.random() * 5), Math.floor(10 + Math.random() * 5)));
                    resPopulation -= 1;
                }
                while(resPopulation > 20) {
                    const currNum = Math.floor(Math.random()*(80) + 20)
                    resList.push(new BuildingRes(currNum));
                    resPopulation -= currNum;
                }
                resList.push(new BuildingRes(resPopulation));
                return;
            }

            function getWorkList(){
                var workPopulation = population;
                workList = [];
                var mainRes = resList[0];
                console.log(mainRes.x);
                var mainX = Math.floor((mainDist * 2) + mainRes.x + Math.random() * 10);
                var mainY = Math.floor((mainDist * 2) + mainRes.y + Math.random() * 10);
                workList.push(new BuildingWork(1, mainX, mainY));
                while(workPopulation > 50) {
                    const currNum = Math.floor(Math.random()*(150) + 50)
                    workList.push(new BuildingWork(currNum));
                    workPopulation -= currNum;
                }
                workList.push(new BuildingWork(workPopulation));
                return;
            }


            function getWalkingDistancePairs(){
                walkPairs = [];
                for (var i = 0; i < resList.length; i ++) {
                    for (var j = 0; j < workList.length; j++) {
                        var currRes = resList[i];
                        var currWork = workList[j];
                        if (Math.abs(currRes.x - currWork.x) < 8 && Math.abs(currRes.y - currWork.y) < 8) {
                            walkPairs.push([currRes, currWork]);
                        }
                    }
                }
                var [firstRes, firstWork] = walkPairs[0];
                return;
            }


            function getRandomBuilding(L) {
                var curr = L[0];
                while(true) {
                    curr = L[Math.floor(Math.random()*L.length)];
                    if (curr.currNumPeople < curr.numPeople) {
                        curr.currNumPeople ++;
                        break;
                    }
                }
                return curr;
            }

            function getRandomWalkPair() {
                var [currRes, currWork] = walkPairs[0];
                while(true) {
                    [currRes, currWork] = walkPairs[Math.floor(Math.random()*walkPairs.length)];
                    if (currRes.currNumPeople < currRes.numPeople && currWork.currNumPeople < currWork.numPeople) {
                        currRes.currNumPeople ++;
                        currWork.currNumPeople ++;
                        break;
                    }
                }
                return [currRes, currWork];
            }

            function getResWork(){
                var currRes = getRandomBuilding(resList);
                var currWork = getRandomBuilding(workList);
                return [currRes, currWork];
            }

            function renewBlock () {
                blocks = [];
                for(var i = 0; i < block_x; i++) {
                    blocks.push([]);
                    for(var j = 0; j < block_y; j++) {
                        blocks[i].push(0);
                    }
                }
            }


            const ctx = canvas.getContext('2d');

            const width = canvas.width;
            const height = canvas.height;
            const block_width = width/block_x;
            const block_height = height/block_y;

            ctx.clearRect(0,0,width,height);
            // ctx.fillStyle = '#000000';
            // ctx.fillRect(0,0,width,height);



            function display() {

                var maxRow = blocks.map(function(row){ return Math.max.apply(Math, row); });
                var max = Math.max.apply(null, maxRow);
                function ReLu(x) {
                    if(x <0) {
                        return 0;
                    } else {
                        return x;
                    }
                }

                for(var i = 0; i < block_x; i++) {
                    for(var j = 0; j < block_y; j++) {
                        if(blocks[i][j] == 0 ) {
                            ctx.fillStyle = '#ffffff';
                            // ctx.fillRect(i*block_width,j*block_width,0.9*block_width,0.9*block_width);
                            ctx.fillRect((i+0.45)*block_width,j*block_height,0.1*block_width,block_height);
                            ctx.fillRect(i*block_width,(j+0.45)*block_height,block_width,0.1*block_height);
                        } else {
                            ctx.fillStyle = rgbToHex(255,Math.floor(ReLu(255*(1-blocks[i][j]*block_x*block_y/cars.length))),Math.floor(ReLu(255*(1-blocks[i][j]*block_x*block_y/cars.length))));
                            ctx.fillRect((i+0.45)*block_width,j*block_height,0.1*block_width,block_height);
                            ctx.fillRect(i*block_width,(j+0.45)*block_height,block_width,0.1*block_height);
                        }
                    }
                }

                for (var b = 0; b < bus.length; b++) {
                    if (!bus[b].arrived && bus[b].spawn_time < time) {
                        var i = bus[b].x_init;
                        var j = bus[b].y_init;
                        ctx.fillStyle = '#0000ff';
                        ctx.fillRect((i+0.45)*block_width,j*block_height,0.1*block_width,block_height);
                        ctx.fillRect(i*block_width,(j+0.45)*block_height,block_width,0.1*block_height);
                    }
                }

                if (freeControl){
                //drawing main, very stupid
                    if (mainMethodNum == 1){
                        var currMain = cars[0];
                        console.log("yes");
                        var i = currMain.x_init;
                        var j = currMain.y_init;
                        ctx.fillStyle = '#00FF00';
                        ctx.fillRect(i*block_width,j*block_width,1*block_width,1*block_width);
                    }

                    if (mainMethodNum == 2){
                        var currMain = bus[0];
                        console.log("yes");
                        var i = currMain.x_init;
                        var j = currMain.y_init;
                        ctx.fillStyle = '#00FF00';
                        ctx.fillRect(i*block_width,j*block_width,1*block_width,1*block_width);
                    }

                    if (mainMethodNum == 3){
                        var currMain = walk[0];
                        console.log("yes");
                        var i = currMain.x_init;
                        var j = currMain.y_init;
                        ctx.fillStyle = '#00FF00';
                        ctx.fillRect(i*block_width,j*block_width,1*block_width,1*block_width);
                    }
                }

                //display buildings
                for (var b = 0; b < workList.length; b++) {
                    var i = workList[b].x;
                    var j = workList[b].y;
                    ctx.fillStyle = '#964B00';
                    ctx.fillRect((i+0.45)*block_width,j*block_height,0.1*block_width,block_height);
                    ctx.fillRect(i*block_width,(j+0.45)*block_height,block_width,0.1*block_height);

                }
            }

            function deleteBuildings() {
                for (var b = 0; b < workList.length; b++) {
                    var i = workList[b].x;
                    var j = workList[b].y;
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect((i+0.45)*block_width,j*block_height,0.1*block_width,block_height);
                    ctx.fillRect(i*block_width,(j+0.45)*block_height,block_width,0.1*block_height);

                }
            }
            function findMainBuildings(){
                return [resList[0], workList[0]];
            }

            function init (){
                time = 0;
                cars = [];
                bus = [];
                walk = [];
                intervalId = null;
                if(freeControl){
                    population = populationButton.value;
                    carper = carperButton.value;
                    busper = busperButton.value;
                    walkper = walkperButton.value;
                    mainDist = mainDistButton.value;
                    mainMethodNum = mainMethodButton.value;
                }
                renewBlock();

                ctx.clearRect(0,0,width,height);
                // deleteBuildings();
                getResList();
                getWorkList();
                getWalkingDistancePairs();

                if (mainMethodNum == 3) {
                    const mainChar = new Walk(true);
                    walk.push(mainChar);
                }

                if (mainMethodNum == 1) {
                    const mainChar = new Car(true);
                    cars.push(mainChar);
                }

                if (mainMethodNum == 2) {
                    const mainChar = new Bus(true);
                    bus.push(mainChar);
                }

                for(var c = 0; c < Math.floor(population * walkper / 100); c++) {
                    const walker = new Walk();
                    walk.push(walker);
                }


                for(var c = 0; c < Math.floor(population * carper / 100); c++) {
                    const driver = new Car();
                    cars.push(driver);
                }

                for(var c = 0; c < Math.floor(population * busper / 100 / 40); c++) {
                    const busDriver = new Bus();
                    bus.push(busDriver);
                }


            }

            function terminate() {

                for (var i = 0; i < cars.length; i++) {
                    if (cars[i].arrived == false) {
                        return false;
                    }
                }
                for (var i = 0; i < bus.length; i++) {
                    if (bus[i].arrived == false) {
                        return false;
                    }
                }
                for (var i = 0; i < walk.length; i++) {
                    if (walk[i].arrived == false) {
                        return false;
                    }
                }
                return true;
            }

            // function move(car) {
            //     if(!arriveX(car)) {
            //         if(car.x_end < car.x_init) {
            //             car.x_init--;
            //         } else {
            //             car.x_init++;
            //         }
            //     } else if (!arriveY(car)) {
            //         if(car.y_end < car.y_init) {
            //             car.y_init--;
            //         } else {
            //             car.y_init++;
            //         }
            //     }
            // }


            function traffic(i,j)  {
                var b = blocks[i][j];
                return Math.floor((b)/5) + 1;
            }


            function findCarCommuteTime() {
                var sum = 0;
                for (var i = 0; i < cars.length; i++) {
                    sum = sum + cars[i].commute_time;
                }
                return sum/cars.length/2;
            }
            function findBusCommuteTime() {
                var sum = 0;
                for (var i = 0; i < bus.length; i++) {
                    sum = sum + bus[i].commute_time;
                }
                return sum/bus.length/2+6;
            }
            function findWalkCommuteTime() {
                var sum = 0;
                for (var i = 0; i < walk.length; i++) {
                    sum = sum + walk[i].commute_time;
                }
                return sum/walk.length/2*4;
            }

            function update () {
                    if (terminate()) {
                        if (cars.length != 0) {
                            averageCar.innerText = parseFloat(findCarCommuteTime()).toFixed(2);
                        } else {
                            averageCar.innerText = "N/A";
                        }
                        if (bus.length != 0) {
                            averageBus.innerText = parseFloat(findBusCommuteTime()).toFixed(2);
                        } else {
                            averageBus.innerText = "N/A";
                        }
                        if (walk.length != 0) {
                            averageWalk.innerText = parseFloat(findWalkCommuteTime()).toFixed(2);
                        } else {
                            console.log("wtf");
                            averageWalk.innerText = "N/A";
                        }
                        if(freeControl) {
                            if (mainMethodNum == 1) {
                            mainTime.innerText = parseFloat((cars[0]).commute_time).toFixed(2);
                            }
                            if (mainMethodNum == 2) {
                                mainTime.innerText = parseFloat((bus[0]).commute_time).toFixed(2);
                            }
                            if (mainMethodNum == 3) {
                                mainTime.innerText = parseFloat(20*mainDist).toFixed(2);
                            }
                        }

                        drawGraph();
                        clearInterval(intervalId);
                    }
                    else{
                        for(var i = 0; i < cars.length; i++) {
                            if (cars[i].spawn_time == time) {
                                if(!arrived(cars[i])) {
                                    cars[i].move_time = cars[i].move_time + traffic(cars[i].x_init, cars[i].y_init);
                                    cars[i].commute_time = cars[i].commute_time + traffic(cars[i].x_init, cars[i].y_init);
                                    blocks[cars[i].x_init][cars[i].y_init]++;
                                } else {
                                    cars[i].arrived = true;
                                }
                            } else if (cars[i].move_time == time ) {
                                blocks[cars[i].x_init][cars[i].y_init]--;
                                move(cars[i]);
                                if(!arrived(cars[i])) {
                                    cars[i].move_time = cars[i].move_time + traffic(cars[i].x_init, cars[i].y_init);
                                    cars[i].commute_time = cars[i].commute_time + traffic(cars[i].x_init, cars[i].y_init);
                                    blocks[cars[i].x_init][cars[i].y_init]++;
                                } else {
                                    cars[i].arrived = true;
                                }

                            }
                        }
                        for(var i = 0; i < bus.length; i++) {
                            if (bus[i].spawn_time == time) {
                                if(!arrived(bus[i])) {
                                    bus[i].move_time = bus[i].move_time + traffic(bus[i].x_init, bus[i].y_init);
                                    bus[i].commute_time = bus[i].commute_time + traffic(bus[i].x_init, bus[i].y_init);
                                    blocks[bus[i].x_init][bus[i].y_init]++;
                                } else {
                                    bus[i].arrived = true;
                                }
                            } else if (bus[i].move_time == time ) {
                                blocks[bus[i].x_init][bus[i].y_init]--;
                                move(bus[i]);
                                if(!arrived(bus[i])) {
                                    bus[i].move_time = bus[i].move_time + traffic(bus[i].x_init, bus[i].y_init);
                                    bus[i].commute_time = bus[i].commute_time + traffic(bus[i].x_init, bus[i].y_init);
                                    blocks[bus[i].x_init][bus[i].y_init]++;
                                } else {
                                    bus[i].arrived = true;
                                }

                            }
                        }

                        for(var i = 0; i < walk.length; i++) {
                            if (walk[i].spawn_time == time) {
                                if(!arrived(walk[i])) {
                                    walk[i].move_time = walk[i].move_time + 1;
                                    walk[i].commute_time = walk[i].commute_time + 1;
                                } else {
                                    walk[i].arrived = true;
                                }
                            } else if (walk[i].move_time == time ) {
                                move(walk[i]);
                                if(!arrived(walk[i])) {
                                    walk[i].move_time = walk[i].move_time + 1;
                                    walk[i].commute_time = walk[i].commute_time + 1;
                                } else {
                                    walk[i].arrived = true;
                                }

                            }
                        }

                        time++;
                        display();
                    }
            }

            function simulate () {
                init();
                intervalId = setInterval(update, 30);
            }

            button.addEventListener("click", simulate);


            function drawGraph() {
              // initialize
              drawBar(ctx1, 0,0,width1, height1, "black");
              // calculate variables
              var carTime = findCarCommuteTime();
              var busTime = findBusCommuteTime();
              var xMax = Math.ceil(Math.max(carTime, busTime)/5) * 5;
              var margin = width1/10;
              var ticker = (height1 - (2*margin))/xMax;
              // draw axis
              drawLine(ctx1,margin, height1 - margin, margin, margin, "white");
              drawLine(ctx1,margin, height1 - margin, width1-margin, height1-margin, "white");
              // draw tickers
              for (var t = 0; t <= xMax; t += 5) {
                var y = (height1 - margin) - t*ticker;
                if (t != 0) {
                  drawLine(ctx1, margin, y, width1-margin, y, "grey");
                }
                drawText(ctx1,margin*2/3, y , String(t), "white", "center", 10, "Arial");
              }
              // calculate bus and bar
              var carY = (height1 - margin) - carTime*ticker;
              var busY = (height1 - margin) - busTime*ticker;
              var xDif = (width1 - (2*margin))/ 10;
              // calculate average commute
              var avgTime = carTime * parseInt(carper)/100 + busTime * parseInt(busper)/100;
              console.log(carTime, carper, busTime, busper, avgTime);
              var avgY = (height1 - margin) - avgTime*ticker;
              // bus Bar
              drawBar(ctx1, margin + xDif, busY, 2*xDif, busTime*ticker, "blue");
              drawText(ctx1,margin + 2*xDif, height1 - margin/2 , "Bus", "white", "center", 25, "Arial");
              // car Bar
              drawBar(ctx1, margin + 4*xDif, carY, 2*xDif, carTime*ticker, "red");
              drawText(ctx1,margin + 5*xDif, height1 - margin/2 , "Car", "white", "center",25, "Arial");
              // avg Bar
              drawBar(ctx1, margin + 7*xDif, avgY, 2*xDif, avgTime*ticker, "yellow");
              drawText(ctx1,margin + 8*xDif, height1 - margin/2 , "Avg", "white", "center",25, "Arial");

              averageTotalTime.innerText = parseFloat(avgTime).toFixed(2);
            }


        function move(car) {
                if(!arriveX(car) && !arriveY(car)) {
                    if (Math.random()<0.5) {
                        if(car.x_end < car.x_init) {
                            car.x_init--;
                        } else {
                            car.x_init++;
                        }
                    } else {
                        if(car.y_end < car.y_init) {
                        car.y_init--;
                        } else {
                            car.y_init++;
                        }
                    }
                } else if (!arriveX(car)) {
                    if(car.x_end < car.x_init) {
                        car.x_init--;
                    } else {
                        car.x_init++;
                    }
                } else if (!arriveY(car)) {
                    if(car.y_end < car.y_init) {
                        car.y_init--;
                    } else {
                        car.y_init++;
                    }
                }
            }

            function arriveX(car) {
                return car.x_init == car.x_end;
            }

            function arriveY(car) {
                return car.y_init == car.y_end;
            }

            function arrived(car) {
                return arriveX(car) && arriveY(car);
            }
          }

            const canvas0 = document.getElementById('cityBar');
            const width0 = canvas0.width;
            const height0 = canvas0.height;
            const ctx0 = canvas0.getContext('2d');

            var cities = [ "New York", "San Francisco","Boston", "Philadelphia",
             "Seattle", "Chicago", "Honolulu"	,"Los Angeles", "San Diego", "Portland",
             "Minneapolis","Baltimore", "Denver","Washington, DC", "Pittsburgh"	,
             "Cleveland"	,"Miami", "Atlanta", "Las Vegas", "Dallas"];
            var monthly = [1208,1071,1050,973,965,955,935,915,869,858,838,829,
              827,810,796,783,762,757,748,743];
            var annual = [14501,12849,12596,11671,11583,11458,11221,10984,10423,
              10295,10053,9950,9919,9724,9553,9399,9143,9089,8973,8912];

            var chosenCity = document.getElementById('metrocity');
            var transper = document.getElementById("transitPercent");
            var cityName;
            var annSav;
            var monSav;

            function setType() {
              //init
              cityName = chosenCity.value;
              annSav = annual[cities.indexOf(cityName)]*parseInt(transper.value)/100;
              monSav = monthly[cities.indexOf(cityName)]*parseInt(transper.value)/100;
              console.log(cityName,annSav, monSav);
              drawComp();
            }
            chosenCity.addEventListener('input', setType);
            transper.addEventListener('input', setType);
            setType();

            function drawComp() {
              // initialize
              drawBar(ctx0, 0,0,width0, height0, "black");
              // calculate variables
              var xMax = Math.ceil(annSav/1000) * 1000;
              console.log(xMax);
              var margin = width0/8;
              var ticker = (height0 - (2*margin))/xMax;
              // draw axis
              drawLine(ctx0,margin, height0 - margin, margin, margin, "white");
              drawLine(ctx0,margin, height0 - margin, width0-margin, height0-margin, "white");
              // draw tickers
              for (var t = 0; t <= xMax; t += 1000) {
                var y = (height0 - margin) - t*ticker;
                if (t != 0) {
                  drawLine(ctx0, margin, y, width0-margin, y, "grey");
                }
                drawText(ctx0,margin*2/5, y , "$" + String(t), "white", "center", 10, "Arial");
              }
              // calculate height
              var annY = (height0 - margin) - annSav*ticker;
              var monY = (height0 - margin) - monSav*ticker;
              var xDif = (width0 - (2*margin))/ 7;
              // Monthly Bar
              drawBar(ctx0, margin + xDif, monY, 2*xDif, monSav*ticker, "green");
              drawText(ctx0,margin + 2*xDif, height0 - margin/2 , "Monthly", "white", "center", 20, "Arial");
              // car Bar
              drawBar(ctx0, margin + 4*xDif, annY, 2*xDif, annSav*ticker, "green");
              drawText(ctx0,margin + 5*xDif, height0 - margin/2 , "Annual", "white", "center",20, "Arial");
            }


        </script>
    </body>
</html>
